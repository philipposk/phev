<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Paper A: Development Progression</title>
  <!-- Mammoth.js for DOCX preview -->
  <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --bg-primary: #f5f7fa;
      --bg-secondary: #ffffff;
      --text-primary: #1a1a1a;
      --text-secondary: #666;
      --accent: #0f4c81;
      --accent-light: #1a6ba3;
      --shadow: rgba(0,0,0,0.1);
      --shadow-hover: rgba(0,0,0,0.15);
    }
    
    [data-theme="dark"] {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2d2d2d;
      --text-primary: #f5f7fa;
      --text-secondary: #b0b0b0;
      --accent: #4a9eff;
      --accent-light: #6bb3ff;
      --shadow: rgba(0,0,0,0.3);
      --shadow-hover: rgba(0,0,0,0.5);
    }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; 
      background: var(--bg-primary); 
      color: var(--text-primary); 
      line-height: 1.6;
      transition: background 0.3s, color 0.3s;
    }
    
    .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 1000;
      background: var(--bg-secondary);
      border: 2px solid var(--accent);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 4px 15px var(--shadow);
      transition: all 0.3s;
    }
    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px var(--shadow-hover);
    }
    
    .home-button {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1000;
      background: var(--bg-secondary);
      border: 2px solid var(--accent);
      border-radius: 8px;
      padding: 0.75rem 1.25rem;
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 4px 15px var(--shadow);
      transition: all 0.3s;
    }
    .home-button:hover {
      background: var(--accent);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow-hover);
      text-decoration: none;
    }
    
    .about-button {
      position: fixed;
      top: 1rem;
      right: 5.5rem;
      z-index: 1000;
      white-space: nowrap;
      background: var(--bg-secondary);
      border: 2px solid var(--accent);
      border-radius: 8px;
      padding: 0.75rem 1.25rem;
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 4px 15px var(--shadow);
      transition: all 0.3s;
    }
    .about-button:hover {
      background: var(--accent);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow-hover);
    }
    
    /* About Modal */
    .about-modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
    }
    .about-modal-content {
      background: var(--bg-secondary);
      margin: 5% auto;
      padding: 0;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      max-height: 85vh;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
    }
    .about-modal-header {
      padding: 1.5rem;
      border-bottom: 2px solid var(--bg-primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      color: white;
      border-radius: 12px 12px 0 0;
    }
    .about-modal-header h3 {
      margin: 0;
      font-size: 1.3rem;
    }
    .about-modal-close {
      color: white;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.3s;
    }
    .about-modal-close:hover {
      background: rgba(255,255,255,0.2);
    }
    .about-modal-body {
      padding: 2rem;
      overflow-y: auto;
      flex: 1;
      min-height: 0;
    }
    .about-modal-body p {
      margin-bottom: 1rem;
      line-height: 1.8;
      color: var(--text-primary);
    }
    .about-modal-body strong {
      color: var(--accent);
    }
    
    header { 
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%); 
      color: #fff; 
      padding: 2rem; 
      box-shadow: 0 4px 20px var(--shadow);
      border-radius: 12px;
      margin: 1rem auto;
      max-width: 1400px;
      transform: perspective(1000px) rotateX(2deg);
      transition: transform 0.3s;
    }
    header:hover {
      transform: perspective(1000px) rotateX(0deg);
    }
    header h1 { font-size: 2rem; margin-bottom: 0.5rem; }
    header p { opacity: 0.9; font-size: 1.1rem; }
    .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
    .tabs { 
      display: flex; 
      gap: 1rem; 
      margin-bottom: 2rem; 
      border-bottom: 2px solid #e0e0e0;
      flex-wrap: wrap;
    }
    .tab { 
      padding: 1rem 1.5rem; 
      cursor: pointer; 
      border: none; 
      background: none; 
      font-size: 1rem; 
      color: #666; 
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }
    .tab:hover { color: #0f4c81; background: #f0f7ff; }
    .tab.active { color: #0f4c81; border-bottom-color: #0f4c81; font-weight: 600; }
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Timeline Styles */
    .timeline-container { position: relative; padding: 2rem 0; }
    .timeline-controls { 
      margin-bottom: 2rem; 
      display: flex; 
      gap: 1rem; 
      flex-wrap: wrap;
      align-items: center;
    }
    .timeline-controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .timeline-controls-row1 {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }
    .timeline-controls-row2 {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    .timeline-controls button, .timeline-controls select {
      padding: 0.5rem 1rem;
      border: 2px solid var(--accent);
      border-radius: 8px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
      box-shadow: 0 2px 8px var(--shadow);
      transform: perspective(1000px) translateZ(0);
    }
    .timeline-controls button:hover, .timeline-controls select:hover {
      background: var(--accent);
      color: white;
      transform: perspective(1000px) translateZ(5px);
      box-shadow: 0 4px 12px var(--shadow-hover);
    }
    .timeline-controls button.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      transform: perspective(1000px) translateZ(10px);
      box-shadow: 0 6px 20px var(--shadow-hover);
      font-weight: 600;
    }
    .round-button {
      border-radius: 50% !important;
      width: 50px;
      height: 50px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    .timeline { 
      position: relative; 
      padding-left: 3rem; 
    }
    .timeline::before {
      content: '';
      position: absolute;
      left: 1.5rem;
      top: 0;
      bottom: 0;
      width: 3px;
      background: #e0e0e0;
    }
    .timeline-item { 
      position: relative; 
      margin-bottom: 3rem; 
      padding-left: 2rem;
      opacity: 1;
      transition: opacity 0.3s;
    }
    .timeline-item.filtered { display: none !important; }
    .timeline-item.hidden { display: none !important; }
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -2.5rem;
      top: 0.5rem;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #0f4c81;
      border: 3px solid white;
      box-shadow: 0 0 0 3px #e0e0e0;
    }
    .timeline-item.milestone::before {
      background: #ff6b35;
      width: 20px;
      height: 20px;
      left: -2.7rem;
      top: 0.3rem;
    }
    .timeline-date { 
      font-weight: 600; 
      color: #0f4c81; 
      font-size: 1.1rem; 
      margin-bottom: 0.5rem;
    }
    .timeline-title { 
      font-size: 1.2rem; 
      font-weight: 600; 
      margin-bottom: 0.5rem; 
      color: #1a1a1a;
    }
    .timeline-content { 
      background: var(--bg-secondary); 
      padding: 1.5rem; 
      border-radius: 12px; 
      box-shadow: 0 4px 15px var(--shadow);
      margin-left: 1rem;
      transition: all 0.3s;
      transform: perspective(1000px) translateZ(0);
    }
    .timeline-content:hover {
      transform: perspective(1000px) translateZ(5px);
      box-shadow: 0 6px 20px var(--shadow-hover);
    }
    .timeline-content p { margin-bottom: 0.5rem; }
    .timeline-tags { 
      display: flex; 
      gap: 0.5rem; 
      flex-wrap: wrap; 
      margin-top: 1rem;
    }
    .tag { 
      padding: 0.25rem 0.75rem; 
      border-radius: 12px; 
      font-size: 0.85rem; 
      background: #e6eef7; 
      color: #0f4c81;
    }
    .tag.milestone { background: #ffe6e0; color: #ff6b35; }
    
    /* Dashboard Styles */
    .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
    .dashboard-card { 
      background: var(--bg-secondary); 
      padding: 1.5rem; 
      border-radius: 12px; 
      box-shadow: 0 4px 15px var(--shadow);
      transition: all 0.3s;
      transform: perspective(1000px) translateZ(0);
    }
    .dashboard-card:hover {
      transform: perspective(1000px) translateZ(5px);
      box-shadow: 0 6px 20px var(--shadow-hover);
    }
    .dashboard-card h3 { 
      color: var(--accent); 
      margin-bottom: 1rem; 
      font-size: 1.2rem;
      border-bottom: 2px solid var(--accent);
      padding-bottom: 0.5rem;
    }
    .file-list { list-style: none; }
    .file-list li { 
      padding: 0.75rem; 
      margin-bottom: 0.5rem; 
      background: var(--bg-primary); 
      border-radius: 8px;
      border-left: 4px solid var(--accent);
      transition: all 0.3s;
      box-shadow: 0 2px 8px var(--shadow);
      transform: perspective(1000px) translateZ(0);
    }
    .file-list li:hover { 
      background: var(--accent); 
      transform: perspective(1000px) translateZ(5px) translateX(4px);
      box-shadow: 0 4px 12px var(--shadow-hover);
    }
    .file-list li:hover a {
      color: white;
    }
    .file-list a { 
      color: var(--accent); 
      text-decoration: none; 
      font-weight: 500;
      display: block;
      transition: color 0.3s;
    }
    .file-list a:hover { text-decoration: underline; }
    .file-meta { 
      font-size: 0.85rem; 
      color: var(--text-secondary); 
      margin-top: 0.25rem;
    }
    .file-type { 
      display: inline-block; 
      padding: 0.2rem 0.5rem; 
      border-radius: 6px; 
      font-size: 0.75rem; 
      background: var(--accent); 
      color: white;
      margin-left: 0.5rem;
    }
    
    /* DOCX Dropdown */
    .docx-dropdown {
      position: relative;
      display: inline-block;
      margin: 2rem 0;
    }
    .docx-main-button {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      color: white;
      padding: 1rem 2rem;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 15px var(--shadow);
      transition: all 0.3s;
      transform: perspective(1000px) translateZ(0);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .docx-main-button:hover {
      transform: perspective(1000px) translateZ(10px);
      box-shadow: 0 6px 20px var(--shadow-hover);
    }
    .docx-dropdown-content {
      display: none;
      position: absolute;
      background: var(--bg-secondary);
      min-width: 300px;
      box-shadow: 0 8px 25px var(--shadow-hover);
      border-radius: 12px;
      z-index: 1000;
      margin-top: 0.5rem;
      max-height: 400px;
      overflow-y: auto;
      transform: perspective(1000px) rotateX(-5deg);
      transition: all 0.3s;
    }
    .docx-dropdown-content.show {
      display: block;
      transform: perspective(1000px) rotateX(0deg);
    }
    .docx-dropdown-content a {
      color: var(--text-primary);
      padding: 0.75rem 1.5rem;
      text-decoration: none;
      display: block;
      border-bottom: 1px solid var(--bg-primary);
      transition: all 0.2s;
    }
    .docx-dropdown-content a:hover {
      background: var(--accent);
      color: white;
      transform: translateX(5px);
    }
    .docx-dropdown-content a:last-child {
      border-bottom: none;
    }
    
    /* Stats */
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .stat-card { 
      background: var(--bg-secondary); 
      padding: 1.5rem; 
      border-radius: 12px; 
      box-shadow: 0 4px 15px var(--shadow);
      text-align: center;
      transition: all 0.3s;
      transform: perspective(1000px) translateZ(0);
    }
    .stat-card:hover {
      transform: perspective(1000px) translateZ(10px);
      box-shadow: 0 8px 25px var(--shadow-hover);
    }
    .stat-card.clickable {
      cursor: pointer;
    }
    .stat-card.clickable:hover {
      transform: perspective(1000px) translateZ(15px) scale(1.02);
    }
    .stat-value { font-size: 2.5rem; font-weight: 700; color: var(--accent); }
    .stat-label { color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem; }
    
    /* Google Drive Button */
    .drive-button { 
      display: inline-flex; 
      align-items: center; 
      gap: 8px; 
      padding: 12px 24px; 
      background: linear-gradient(135deg, #4285f4 0%, #34a853 100%); 
      color: white; 
      border-radius: 8px; 
      text-decoration: none; 
      font-weight: 600; 
      box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
      transition: all 0.3s;
      margin: 1rem 0;
    }
    .drive-button:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 6px 16px rgba(66, 133, 244, 0.4);
      text-decoration: none;
      color: white;
    }
    .drive-section {
      background: var(--bg-secondary);
      border-left: 4px solid #4285f4;
      margin-top: 2rem;
    }
    
    /* File Preview Modal */
    .file-preview-modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
    }
    .file-preview-modal.fullscreen {
      background-color: rgba(0,0,0,0.95);
    }
    .file-preview-content {
      background: var(--bg-secondary);
      margin: 5% auto;
      padding: 0;
      border-radius: 12px;
      width: 90%;
      max-width: 900px;
      max-height: 85vh;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }
    .file-preview-content.fullscreen {
      margin: 0;
      width: 100%;
      height: 100%;
      max-width: 100%;
      max-height: 100%;
      border-radius: 0;
    }
    .file-preview-header {
      padding: 1.5rem;
      border-bottom: 2px solid var(--bg-primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      color: white;
      border-radius: 12px 12px 0 0;
    }
    .file-preview-content.fullscreen .file-preview-header {
      border-radius: 0;
    }
    .file-preview-header-controls {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }
    .file-preview-resize {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .file-preview-resize:hover {
      background: rgba(255,255,255,0.3);
      border-color: rgba(255,255,255,0.5);
    }
    .file-preview-header h3 {
      margin: 0;
      font-size: 1.2rem;
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .file-preview-close {
      color: white;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.3s;
    }
    .file-preview-close:hover {
      background: rgba(255,255,255,0.2);
    }
    .file-preview-body.fullscreen {
      max-height: calc(100vh - 140px);
    }
    .file-preview-body {
      padding: 1.5rem;
      overflow-y: auto;
      flex: 1;
      min-height: 0;
    }
    .file-preview-body img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1rem auto;
      border-radius: 8px;
      box-shadow: 0 2px 8px var(--shadow);
    }
    .file-preview-body figure {
      max-width: 100%;
      margin: 1rem auto;
      text-align: center;
    }
    .file-preview-body figure img {
      max-width: 90%;
      max-height: 60vh;
      object-fit: contain;
    }
    .file-preview-footer {
      padding: 1rem 1.5rem;
      border-top: 2px solid var(--bg-primary);
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      background: var(--bg-primary);
      border-radius: 0 0 12px 12px;
    }
    .file-preview-download {
      padding: 0.75rem 1.5rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    .file-preview-download:hover {
      background: var(--accent-light);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    /* Search */
    .search-box { 
      width: 100%; 
      padding: 0.75rem; 
      border: 2px solid #e0e0e0; 
      border-radius: 6px; 
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    .search-box:focus { outline: none; border-color: #0f4c81; }
    
    @media (max-width: 768px) {
      .timeline { padding-left: 2rem; }
      .timeline-item::before { left: -1.5rem; }
      .timeline-content { margin-left: 0.5rem; }
      .about-button {
        right: 4rem;
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }
      .theme-toggle {
        width: 45px;
        height: 45px;
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
    <span id="themeIcon">üåô</span>
  </button>
  
  <button class="about-button" onclick="openAboutModal()" title="About this website">
    ‚ÑπÔ∏è About
  </button>
  
  <a href="index.html" class="home-button" title="Go to Home Page">üè† Home</a>
  
  <header>
    <h1>Paper A: Development Progression</h1>
    <p>The real-world energy use and electric driving share of plug-in hybrid vehicles in Europe</p>
  </header>
  
  <div class="container">
    <!-- DOCX Dropdown -->
    <div class="docx-dropdown">
      <button class="docx-main-button" onclick="toggleDocxDropdown()">
        üìÑ Final Paper (DOCX)
        <span id="docxArrow">‚ñº</span>
      </button>
      <div class="docx-dropdown-content" id="docxDropdown">
        <!-- Will be populated by JavaScript -->
      </div>
    </div>
    <div class="tabs">
      <button class="tab active" onclick="showTab('timeline')">Timeline</button>
      <button class="tab" onclick="showTab('status')">Script Status</button>
      <button class="tab" onclick="showTab('dashboard')">Dashboard</button>
      <button class="tab" onclick="showTab('guide')">Build Guide</button>
      <button class="tab" onclick="showTab('logs')">Logs</button>
    </div>
    
    <!-- Timeline Tab -->
    <div id="timeline" class="tab-content active">
      <div class="stats">
        <div class="stat-card">
          <div class="stat-value">26</div>
          <div class="stat-label">Clean Variables</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">7</div>
          <div class="stat-label">Models</div>
        </div>
        <div class="stat-card clickable" onclick="window.open('tables_portfolio.html#table5', '_blank')" style="cursor: pointer;" title="Click to view model comparison table (Table 5)">
          <div class="stat-value">73.71%</div>
          <div class="stat-label">Best R¬≤ (XGBoost)</div>
        </div>
        <div class="stat-card clickable" onclick="window.location.href='figures_portfolio.html'" style="cursor: pointer;">
          <div class="stat-value">34</div>
          <div class="stat-label">Figures</div>
        </div>
        <div class="stat-card clickable" onclick="window.location.href='tables_portfolio.html'" style="cursor: pointer;">
          <div class="stat-value">16</div>
          <div class="stat-label">Tables</div>
        </div>
      </div>
      
      <div class="timeline-controls">
        <div class="timeline-controls-row1">
          <button class="active" onclick="filterTimeline('all')">All Items</button>
          <button onclick="filterTimeline('important')">Important (100)</button>
          <button onclick="filterTimeline('most_important')">Most Important (10)</button>
          <button onclick="filterTimeline('milestone')">Milestones Only</button>
          <button onclick="filterTimeline('correction')">Corrections</button>
          <select onchange="filterTimelineByType(this.value)">
            <option value="all">All Types</option>
            <option value="methodology">Methodology</option>
            <option value="correction">Corrections</option>
            <option value="output">Output</option>
            <option value="documentation">Documentation</option>
          </select>
        </div>
        <div class="timeline-controls-row2">
          <button class="round-button" onclick="toggleSortOrder()" title="Toggle Sort Order">
            <span id="sortIcon">‚áÖ</span>
          </button>
          <span id="sortLabel" style="color: var(--text-secondary); font-size: 0.9rem; margin-left: 0.5rem;">Chronological (Old ‚Üí New)</span>
        </div>
      </div>
      
      <div class="timeline-container">
        <div class="timeline" id="timeline-content">
          <!-- Timeline items will be inserted here by JavaScript -->
        </div>
      </div>
    </div>
    
    <!-- Script Status Tab -->
    <div id="status" class="tab-content">
      <div class="dashboard-card">
        <h3>üìä Script Status</h3>
        <div id="script-status-content">
          <p>Loading script status...</p>
        </div>
        <div id="script-status-explanation"></div>
      </div>
    </div>
    
    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content">
      <input type="text" class="search-box" placeholder="Search files..." onkeyup="searchFiles(this.value)">
      
      <div class="dashboard">
        <div class="dashboard-card">
          <h3>üìÑ Paper Files</h3>
          <ul class="file-list" id="paper-files">
            <!-- Will be populated by JavaScript -->
          </ul>
        </div>
        
        <div class="dashboard-card">
          <h3>üìä Analysis Scripts</h3>
          <ul class="file-list" id="script-files">
            <!-- Will be populated by JavaScript -->
          </ul>
        </div>
        
        <div class="dashboard-card">
          <h3>üìà Results & Data</h3>
          <ul class="file-list" id="result-files">
            <!-- Will be populated by JavaScript -->
          </ul>
        </div>

        <div class="dashboard-card">
          <h3>üìã Documentation</h3>
          <ul class="file-list" id="doc-files">
            <!-- Will be populated by JavaScript -->
          </ul>
        </div>

        <div class="dashboard-card">
          <h3>üìù Log Files</h3>
          <ul class="file-list" id="log-files">
            <!-- Will be populated by JavaScript -->
          </ul>
        </div>

        <div class="dashboard-card">
          <h3>üîß All Scripts</h3>
          <ul class="file-list" id="scripts-all-files">
            <!-- Will be populated by JavaScript -->
          </ul>
        </div>

        <div class="dashboard-card">
          <h3>üõ†Ô∏è Utility Scripts</h3>
          <ul class="file-list" id="utilities-files">
            <!-- Will be populated by JavaScript -->
          </ul>
        </div>

        <div class="dashboard-card">
          <h3>üìö Documentation</h3>
          <ul class="file-list" id="doc-files">
            <!-- Will be populated by JavaScript -->
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Build Guide Tab -->
    <div id="guide" class="tab-content">
      <div class="dashboard-card">
        <h3>Quick Links</h3>
        <ul class="file-list">
          <li><a href="#" onclick="openFileFromDrive('PAPER_BUILD_GUIDE.md', event); return false;">Complete Build Guide</a> <span class="file-type">MD</span></li>
          <li><a href="#" onclick="openFileFromDrive('METHODOLOGY_EVOLUTION_DOCUMENTATION.md', event); return false;">Methodology Evolution</a> <span class="file-type">MD</span></li>
          <li><a href="#" onclick="openFileFromDrive('VARIABLE_SELECTION_DOCUMENTATION.md', event); return false;">Variable Selection</a> <span class="file-type">MD</span></li>
          <li><a href="#" onclick="openFileFromDrive('TODO_PAPER_COMPLETION.md', event); return false;">TODO Checklist</a> <span class="file-type">MD</span></li>
          <li><a href="#" onclick="openFileFromDrive('MARKOS_REVIEW_NEEDED.md', event); return false;">Review Items</a> <span class="file-type">MD</span></li>
        </ul>
      </div>
    </div>
    
    <!-- Logs Tab -->
    <div id="logs" class="tab-content">
      <div class="dashboard-card">
        <h3>Analysis Logs</h3>
        <ul class="file-list">
          <li><a href="#" onclick="openFileFromDrive('all_models_CLEAN.log', event); return false;">All Models (Clean Variables)</a> <span class="file-type">LOG</span></li>
          <li><a href="#" onclick="openFileFromDrive('comprehensive_analysis_ALL.log', event); return false;">Comprehensive Analysis</a> <span class="file-type">LOG</span></li>
          <li><a href="#" onclick="openFileFromDrive('eds_comprehensive_analysis.log', event); return false;">EDS Analysis</a> <span class="file-type">LOG</span></li>
          <li><a href="#" onclick="openFileFromDrive('future_work_analyses.log', event); return false;">Future Work Analyses</a> <span class="file-type">LOG</span></li>
        </ul>
      </div>
      
      <div class="dashboard-card">
        <h3>Development Logs</h3>
        <ul class="file-list">
          <li><a href="#" onclick="openFileFromDrive('DEVELOPMENT_LOG_COMPLETE.md', event); return false;">Complete Log</a> <span class="file-type">MD</span></li>
          <li><a href="#" onclick="openFileFromDrive('DEVELOPMENT_LOG_SUMMARY.md', event); return false;">Summary Log</a> <span class="file-type">MD</span></li>
        </ul>
      </div>
    </div>
  </div>
  
  <script>
    // Google Drive link configuration (defined at top for all functions)
    const DRIVE_FOLDER_URL = 'https://drive.google.com/drive/folders/1PSRm7LG9QyBRnVgHREzQITe5Bthrniro?usp=sharing';
    
    // Function to open files (local or Google Drive)
    function openFileFromDrive(fileName, event) {
      if (event) {
        event.preventDefault();
      }
      
      // Determine if file is MD or LOG and use local path
      const ext = fileName.split('.').pop().toLowerCase();
      let filePath = '';
      
      if (ext === 'md') {
        filePath = `docs/${fileName}`;
      } else if (ext === 'log') {
        filePath = `logs/${fileName}`;
      } else {
        // For other files, use Google Drive
        showFilePreview(DRIVE_FOLDER_URL, fileName);
        return;
      }
      
      // Try to open local file first
      showFilePreview(filePath, fileName);
    }
    
    // Load timeline data from JSON
    let timelineData = [];
    let allTimelineData = [];
    
    // Load JSON data
    fetch('../paper_a_analysis/TIMELINE_DATA.json')
      .then(response => response.json())
      .then(data => {
        allTimelineData = data.timeline;
        timelineData = allTimelineData;
        renderTimeline();
      })
      .catch(error => {
        console.error('Error loading timeline data:', error);
        // Fallback to empty
        timelineData = [];
        allTimelineData = [];
      });
    
    // Legacy data structure for compatibility
    const legacyTimelineData = [
      {
        date: "December 2024",
        title: "Baseline Established",
        type: "milestone",
        content: "Created initial data loading and cleaning scripts. Established baseline with simple linear model (3 variables: mass, AER, region).",
        result: "44.65% R¬≤",
        files: ["01_data_loading.R", "02_data_cleaning.R", "03_energy_calculations.R", "05_variable_importance.R"],
        tags: ["Baseline", "Initial Analysis"]
      },
      {
        date: "January 2025",
        title: "Feature Engineering",
        type: "milestone",
        content: "Added EDS as critical predictor. Created engineered features (ratios, interactions). Expanded to 12 variables.",
        result: "59.44% R¬≤ (Random Forest)",
        files: ["05_variable_importance_FINAL.R"],
        tags: ["Feature Engineering", "EDS Added"]
      },
      {
        date: "February-March 2025",
        title: "Hyperparameter Tuning",
        type: "milestone",
        content: "Systematic hyperparameter tuning. Expanded to 18 variables. Added engine displacement, vehicle length, registration year.",
        result: "71.56% R¬≤ (Random Forest, intermediate phase)",
        files: ["Updated 05_variable_importance_FINAL.R"],
        tags: ["Tuning", "Intermediate Phase"]
      },
      {
        date: "April-May 2025",
        title: "Comprehensive Analysis",
        type: "milestone",
        content: "Expanded to 44 variables. Implemented 7 models (RF, XGBoost, LightGBM, CatBoost, GAM, NN, Ensemble). Extensive hyperparameter tuning.",
        result: "91.88% R¬≤ (Random Forest) - later identified as inflated",
        files: ["09_comprehensive_model_comparison_ALL.R", "10_create_comprehensive_figures_ALL.R"],
        tags: ["Comprehensive", "All Models"]
      },
      {
        date: "June 2025",
        title: "Circular Variables Identified",
        type: "correction",
        content: "Identified 25 circular variables (derived from outcome). Created script to identify and document them.",
        result: "26 clean variables selected",
        files: ["09d_identify_circular_variables.R", "VARIABLE_SELECTION_DOCUMENTATION.md"],
        tags: ["Correction", "Variable Selection"]
      },
      {
        date: "July 2025",
        title: "Clean Variable Selection",
        type: "milestone",
        content: "Applied VIF-based multicollinearity reduction. Selected final 26 clean variables.",
        result: "26 clean variables finalized",
        files: ["09f_final_variable_selection_CLEAN.R", "tables/final_selected_variables_CLEAN.csv"],
        tags: ["Variable Selection", "Clean Variables"]
      },
      {
        date: "August-September 2025",
        title: "Clean Variable Analysis",
        type: "milestone",
        content: "Re-ran all models with 26 clean variables. Used parameter transfer approach (best hyperparameters from 44-variable runs).",
        result: "71.63% R¬≤ (RF), 73.71% (XGBoost), 73.22% (NN), 64.31% (GAM)",
        files: ["09g_all_models_CLEAN_variables.R", "tables/model_comparison_CLEAN_variables.csv"],
        tags: ["Clean Variables", "Realistic Results"]
      },
      {
        date: "October 2025",
        title: "EDS Comprehensive Analysis",
        type: "milestone",
        content: "Created comprehensive country-level EDS analysis. Fixed temperature data merging (explicitly use MS column).",
        result: "10 analysis types, 16 tables, 19 figures",
        files: ["11_eds_comprehensive_analysis.R", "12_create_eds_comprehensive_figures.R"],
        tags: ["EDS Analysis", "Country-Level"]
      },
      {
        date: "November 2025",
        title: "Future Work Analyses",
        type: "milestone",
        content: "Created individual vehicle EDS prediction, temporal analysis, charging infrastructure analysis. Fixed circularity in EDS prediction.",
        result: "3 new analysis types, 3 figures",
        files: ["13_individual_vehicle_eds_analysis.R", "14_temporal_analysis.R", "15_charging_infrastructure_analysis.R"],
        tags: ["Future Work", "Additional Analyses"]
      },
      {
        date: "December 2025",
        title: "Consistency Fixes",
        type: "correction",
        content: "Fixed all consistency issues: 71.56% vs 71.63%, variable sets (26 vs 44), section updates. Updated Section 1.4 and 5.3. Fixed abstract.",
        result: "All sections consistent",
        files: ["PAPER_DRAFT.md", "PAPER_DRAFT_20_CONSISTENCY_FIXED.docx"],
        tags: ["Correction", "Finalization"]
      },
      {
        date: "17 Dec 2025 05:00",
        title: "‚úÖ Ensemble Model Completed",
        type: "milestone",
        content: "Ensemble model successfully completed. Fixed skip logic for GAM, fixed saving section to use all_results. Ensemble combines RF, XGBoost, GAM, and Neural Network using weighted average based on test R¬≤.",
        result: "Ensemble: 73.54% test R¬≤, 2.98 kWh/100 km RMSE, 2.07 kWh/100 km MAE, 9.56% MAPE",
        files: ["09g_all_models_CLEAN_variables.R", "tables/model_comparison_CLEAN_variables.csv"],
        tags: ["Models", "Ensemble", "Complete"]
      },
      {
        date: "17 Dec 2025 05:10",
        title: "‚úÖ Final Comparison Figures Created",
        type: "milestone",
        content: "Created 3 new comparison figures: figure6_model_comparison_final.png (R¬≤ comparison with Ensemble), figure6b_comprehensive_metrics_comparison.png (all metrics), figure6c_train_test_comparison.png (generalization).",
        result: "3 new figures added",
        files: ["create_final_comparison_figures.R", "figures/figure6_model_comparison_final.png", "figures/figure6b_comprehensive_metrics_comparison.png", "figures/figure6c_train_test_comparison.png"],
        tags: ["Figures", "Visualization", "Complete"]
      },
      {
        date: "17 Dec 2025 05:15",
        title: "‚úÖ Final Paper DOCX Generated",
        type: "milestone",
        content: "Generated PAPER_DRAFT_27_FINAL_COMPLETE.docx with all updates: Ensemble results, updated figure captions, all model comparisons, comprehensive metrics. Paper ready for Markos review.",
        result: "Final DOCX with all models including Ensemble",
        files: ["PAPER_DRAFT_27_FINAL_COMPLETE.docx", "PAPER_DRAFT.md"],
        tags: ["Document", "Final", "Complete"]
      }
    ];
    
    // File data for dashboard
    const fileData = {
      paper: [
        { name: "PAPER_DRAFT.md", path: "docs/PAPER_DRAFT.md", type: "MD", desc: "Main paper source (single source of truth)" },
        { name: "LATEST_PAPER_DRAFT.docx", path: "LATEST_PAPER_DRAFT.docx", type: "DOCX", desc: "üéØ LATEST - Always the most recent paper draft (auto-updated)" },
        { name: "PAPER_DRAFT_34.docx", path: "../paper_a_analysis/PAPER_DRAFT_34.docx", type: "DOCX", desc: "üéØ NEWEST - Updated author: Markos A. Ktistakis, ... (Dec 2025)" },
        { name: "PAPER_DRAFT_27_FINAL_COMPLETE.docx", path: "../paper_a_analysis/PAPER_DRAFT_27_FINAL_COMPLETE.docx", type: "DOCX", desc: "FINAL - All models complete including Ensemble" },
        { name: "PAPER_OUTLINE.md", path: "docs/PAPER_OUTLINE.md", type: "MD", desc: "Paper structure outline" }
      ],
      scripts: [
        { name: "09g_all_models_CLEAN_variables.R", path: "../paper_a_analysis/09g_all_models_CLEAN_variables.R", type: "R", desc: "‚úÖ Main analysis script (all models + Ensemble, 26 clean vars)" },
        { name: "create_final_comparison_figures.R", path: "../paper_a_analysis/create_final_comparison_figures.R", type: "R", desc: "Creates final comparison figures (6, 6b, 6c)" },
        { name: "11_eds_comprehensive_analysis.R", path: "../paper_a_analysis/11_eds_comprehensive_analysis.R", type: "R", desc: "EDS country-level analysis" },
        { name: "12_create_eds_comprehensive_figures.R", path: "../paper_a_analysis/12_create_eds_comprehensive_figures.R", type: "R", desc: "Create EDS figures" },
        { name: "13_individual_vehicle_eds_analysis.R", path: "../paper_a_analysis/13_individual_vehicle_eds_analysis.R", type: "R", desc: "Individual vehicle EDS prediction" },
        { name: "14_temporal_analysis.R", path: "../paper_a_analysis/14_temporal_analysis.R", type: "R", desc: "Temporal trends analysis" },
        { name: "15_charging_infrastructure_analysis.R", path: "../paper_a_analysis/15_charging_infrastructure_analysis.R", type: "R", desc: "Charging infrastructure analysis" },
        { name: "99_run_future_work_analyses.R", path: "../paper_a_analysis/99_run_future_work_analyses.R", type: "R", desc: "Master script for future work" }
      ],
      results: [
        { name: "model_comparison_CLEAN_variables.csv", path: "../paper_a_analysis/tables/model_comparison_CLEAN_variables.csv", type: "CSV", desc: "‚úÖ Final model results (RF, XGBoost, GAM, NN, Ensemble - 26 clean vars)" },
        { name: "final_selected_variables_CLEAN.csv", path: "../paper_a_analysis/tables/final_selected_variables_CLEAN.csv", type: "CSV", desc: "26 clean variables list" },
        { name: "linear_model_baseline_results.csv", path: "../paper_a_analysis/tables/linear_model_baseline_results.csv", type: "CSV", desc: "Linear model baseline results" }
      ],
      docs: [
        { name: "PAPER_BUILD_GUIDE.md", path: "docs/PAPER_BUILD_GUIDE.md", type: "MD", desc: "Complete build guide" },
        { name: "METHODOLOGY_EVOLUTION_DOCUMENTATION.md", path: "docs/METHODOLOGY_EVOLUTION_DOCUMENTATION.md", type: "MD", desc: "Methodology evolution" },
        { name: "VARIABLE_SELECTION_DOCUMENTATION.md", path: "docs/VARIABLE_SELECTION_DOCUMENTATION.md", type: "MD", desc: "Variable selection rationale" },
        { name: "DEVELOPMENT_LOG_COMPLETE.md", path: "docs/DEVELOPMENT_LOG_COMPLETE.md", type: "MD", desc: "Complete development log" },
        { name: "DEVELOPMENT_LOG_SUMMARY.md", path: "docs/DEVELOPMENT_LOG_SUMMARY.md", type: "MD", desc: "Summary log (important only)" },
        { name: "TODO_PAPER_COMPLETION.md", path: "docs/TODO_PAPER_COMPLETION.md", type: "MD", desc: "Completion checklist" },
        { name: "MARKOS_REVIEW_NEEDED.md", path: "docs/MARKOS_REVIEW_NEEDED.md", type: "MD", desc: "Items for review" },
        { name: "FUTURE_WORK_PROPOSAL.md", path: "docs/FUTURE_WORK_PROPOSAL.md", type: "MD", desc: "Future work proposals" },
        { name: "ALL_MODELS_COMPLETE_SUMMARY.md", path: "docs/ALL_MODELS_COMPLETE_SUMMARY.md", type: "MD", desc: "All models summary" },
        { name: "COMPLETE_UPDATE_SUMMARY.md", path: "docs/COMPLETE_UPDATE_SUMMARY.md", type: "MD", desc: "Complete update summary" }
      ],
      logs: [
        { name: "all_models_CLEAN.log", path: "logs/all_models_CLEAN.log", type: "LOG", desc: "All models script log (26 clean vars)" },
        { name: "comprehensive_analysis_ALL.log", path: "logs/comprehensive_analysis_ALL.log", type: "LOG", desc: "Comprehensive analysis (all models) log" },
        { name: "comprehensive_analysis.log", path: "logs/comprehensive_analysis.log", type: "LOG", desc: "Comprehensive analysis log" },
        { name: "eds_comprehensive_analysis.log", path: "logs/eds_comprehensive_analysis.log", type: "LOG", desc: "EDS comprehensive analysis log" },
        { name: "eds_analysis.log", path: "logs/eds_analysis.log", type: "LOG", desc: "EDS analysis log" },
        { name: "future_work_analyses.log", path: "logs/future_work_analyses.log", type: "LOG", desc: "Future work analyses log" },
        { name: "monitor.log", path: "logs/monitor.log", type: "LOG", desc: "Monitor script log" }
      ],
      scripts_all: [
        { name: "01_data_loading.R", path: "../paper_a_analysis/01_data_loading.R", type: "R", desc: "Data loading script" },
        { name: "02_data_cleaning.R", path: "../paper_a_analysis/02_data_cleaning.R", type: "R", desc: "Data cleaning script" },
        { name: "03_energy_calculations.R", path: "../paper_a_analysis/03_energy_calculations.R", type: "R", desc: "Energy calculations" },
        { name: "05_variable_importance_FINAL.R", path: "../paper_a_analysis/05_variable_importance_FINAL.R", type: "R", desc: "Variable importance analysis" },
        { name: "09g_all_models_CLEAN_variables.R", path: "../paper_a_analysis/09g_all_models_CLEAN_variables.R", type: "R", desc: "‚úÖ All models + Ensemble (26 clean vars)" },
        { name: "create_final_comparison_figures.R", path: "../paper_a_analysis/create_final_comparison_figures.R", type: "R", desc: "Creates comparison figures 6, 6b, 6c" },
        { name: "11_eds_comprehensive_analysis.R", path: "../paper_a_analysis/11_eds_comprehensive_analysis.R", type: "R", desc: "EDS comprehensive analysis" },
        { name: "12_create_eds_comprehensive_figures.R", path: "../paper_a_analysis/12_create_eds_comprehensive_figures.R", type: "R", desc: "Create EDS figures" },
        { name: "13_individual_vehicle_eds_analysis.R", path: "../paper_a_analysis/13_individual_vehicle_eds_analysis.R", type: "R", desc: "Individual vehicle EDS" },
        { name: "14_temporal_analysis.R", path: "../paper_a_analysis/14_temporal_analysis.R", type: "R", desc: "Temporal analysis" },
        { name: "15_charging_infrastructure_analysis.R", path: "../paper_a_analysis/15_charging_infrastructure_analysis.R", type: "R", desc: "Charging infrastructure" },
        { name: "99_run_future_work_analyses.R", path: "../paper_a_analysis/99_run_future_work_analyses.R", type: "R", desc: "Master script for future work" }
      ],
      utilities: [
        { name: "monitor_script_status.sh", path: "../paper_a_analysis/monitor_script_status.sh", type: "SH", desc: "Monitor script status and send notifications" },
        { name: "check_and_notify_when_done.sh", path: "../paper_a_analysis/check_and_notify_when_done.sh", type: "SH", desc: "Check analysis status and notify" },
        { name: "monitor_and_notify.py", path: "../paper_a_analysis/monitor_and_notify.py", type: "PY", desc: "Python monitor script" }
      ]
    };
    
    // Tab switching
    function showTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById(tabName).classList.add('active');
    }
    
    // Timeline rendering
    function renderTimeline(data = timelineData) {
      const container = document.getElementById('timeline-content');
      if (!data || data.length === 0) {
        container.innerHTML = '<p>Loading timeline data...</p>';
        return;
      }
      
      container.innerHTML = data.map((item, index) => {
        const importance = item.importance || 100;
        const importanceClass = importance === 10 ? 'most-important' : importance === 100 ? 'important' : 'all-items';
          const fileLinks = (item.files || []).map(file => {
          // Determine file path based on extension
          // Files in repo: figures, tables, LATEST_PAPER_DRAFT.docx
          // Other files: point to Google Drive
          let filePath = '';
          if (file.endsWith('.png')) {
            // Figures are in repo
            filePath = `figures/${file}`;
          } else if (file.endsWith('.csv')) {
            // Tables are in repo
            filePath = `tables/${file}`;
          } else if (file.includes('PAPER_DRAFT') && file.endsWith('.docx')) {
            // Check if it's the latest (always available as LATEST_PAPER_DRAFT.docx)
            if (file.includes('LATEST') || file === 'PAPER_DRAFT_34.docx' || file === 'PAPER_DRAFT_33_COMPLETE_WITH_ALL_FIGURES.docx') {
              filePath = 'LATEST_PAPER_DRAFT.docx';
            } else {
              // Other DOCX files are in Google Drive
              filePath = DRIVE_FOLDER_URL;
            }
          } else {
            // All other files (MD, R, LOG, etc.) are in Google Drive
            filePath = DRIVE_FOLDER_URL;
          }
          return `<li><a href="#" target="_blank" onclick="event.stopPropagation(); openFile('${filePath}', event); return false;">${file}</a></li>`;
        }).join('');
        
        // Format date for display (already includes time from JSON)
        const displayDate = item.date; // Format: "16 Dec 2025 14:30"
        
        return `
        <div class="timeline-item ${item.type} ${importanceClass}" data-type="${item.type}" data-importance="${importance}">
          <div class="timeline-date">${displayDate}</div>
          <div class="timeline-content">
            <div class="timeline-title">${item.title}</div>
            <p>${item.content}</p>
            ${item.result ? `<p><strong>Result:</strong> ${item.result}</p>` : ''}
            ${fileLinks ? `
              <div style="margin-top: 1rem;">
                <strong>Files:</strong>
                <ul style="margin-top: 0.5rem; margin-left: 1.5rem; list-style: none; padding-left: 0;">
                  ${fileLinks}
                </ul>
              </div>
            ` : ''}
            <div class="timeline-tags">
              ${(item.tags || []).map(tag => `<span class="tag ${item.type === 'milestone' ? 'milestone' : ''}">${tag}</span>`).join('')}
              <span class="tag" style="background: #e8f4f8; color: #0f4c81;">Importance: ${importance}</span>
            </div>
          </div>
        </div>
      `;
      }).join('');
    }
    
    // Timeline filtering
    function filterTimeline(filter) {
      document.querySelectorAll('.timeline-controls button').forEach(b => {
        if (b.textContent.includes(filter) || (filter === 'all' && b.textContent.includes('All'))) {
          b.classList.add('active');
        } else {
          b.classList.remove('active');
        }
      });
      
      const items = document.querySelectorAll('.timeline-item');
      items.forEach(item => {
        const importance = parseInt(item.dataset.importance) || 100;
        const type = item.dataset.type;
        
        if (filter === 'all') {
          item.classList.remove('filtered', 'hidden');
        } else if (filter === 'important') {
          if (importance === 100 || importance === 10) {
            item.classList.remove('filtered', 'hidden');
          } else {
            item.classList.add('hidden');
          }
        } else if (filter === 'most_important') {
          if (importance === 10) {
            item.classList.remove('filtered', 'hidden');
          } else {
            item.classList.add('hidden');
          }
        } else if (filter === 'milestone') {
          if (type === 'milestone') {
            item.classList.remove('filtered', 'hidden');
          } else {
            item.classList.add('hidden');
          }
        } else if (filter === 'correction') {
          if (type === 'correction') {
            item.classList.remove('filtered', 'hidden');
          } else {
            item.classList.add('hidden');
          }
        }
      });
    }
    
    // Filter by type
    function filterTimelineByType(type) {
      const items = document.querySelectorAll('.timeline-item');
      items.forEach(item => {
        if (type === 'all' || item.dataset.type === type) {
          item.classList.remove('filtered', 'hidden');
        } else {
          item.classList.add('hidden');
        }
      });
    }
    
    let sortOrder = 'chronological';
    
    // Timeline sorting
    function toggleSortOrder() {
      sortOrder = sortOrder === 'chronological' ? 'reverse' : 'chronological';
      const container = document.getElementById('timeline-content');
      const items = Array.from(container.children).filter(item => !item.classList.contains('hidden'));
      
      // Parse dates in format "16 Dec 2025 14:30"
      const parseDate = (dateStr) => {
        const parts = dateStr.trim().split(' ');
        if (parts.length >= 4) {
          const day = parseInt(parts[0]);
          const month = parts[1];
          const year = parseInt(parts[2]);
          const time = parts[3] || '00:00';
          const [hour, minute] = time.split(':').map(Number);
          const monthMap = { 'Jan': 1, 'Feb': 2, 'Mar': 3, 'Apr': 4, 'May': 5, 'Jun': 6,
                            'Jul': 7, 'Aug': 8, 'Sep': 9, 'Oct': 10, 'Nov': 11, 'Dec': 12 };
          return new Date(year, monthMap[month] - 1, day, hour, minute);
        }
        return new Date(0);
      };
      
      if (sortOrder === 'reverse') {
        items.sort((a, b) => {
          const dateA = a.querySelector('.timeline-date').textContent;
          const dateB = b.querySelector('.timeline-date').textContent;
          return parseDate(dateB) - parseDate(dateA);
        });
        document.getElementById('sortIcon').textContent = '‚áÖ';
        document.getElementById('sortLabel').textContent = 'Reverse (New ‚Üí Old)';
      } else {
        items.sort((a, b) => {
          const dateA = a.querySelector('.timeline-date').textContent;
          const dateB = b.querySelector('.timeline-date').textContent;
          return parseDate(dateA) - parseDate(dateB);
        });
        document.getElementById('sortIcon').textContent = '‚áÖ';
        document.getElementById('sortLabel').textContent = 'Chronological (Old ‚Üí New)';
      }
      items.forEach(item => container.appendChild(item));
    }
    
    // DOCX Dropdown - sorted by version number (newest first)
    // Latest DOCX is always available as LATEST_PAPER_DRAFT.docx in the repo
    const docxFiles = [
      { name: "LATEST_PAPER_DRAFT.docx", path: "LATEST_PAPER_DRAFT.docx", desc: "üéØ LATEST - Always the most recent paper draft (auto-updated)" },
      { name: "PAPER_DRAFT_34.docx", path: "../paper_a_analysis/PAPER_DRAFT_34.docx", desc: "üéØ NEWEST - Updated author: Markos A. Ktistakis, ... (Dec 2025)" },
      { name: "PAPER_DRAFT_33_COMPLETE_WITH_ALL_FIGURES.docx", path: "../paper_a_analysis/PAPER_DRAFT_33_COMPLETE_WITH_ALL_FIGURES.docx", desc: "Complete with all figures (Dec 17, 2025)" },
      { name: "PAPER_DRAFT_32_TABLES_FIXED.docx", path: "../paper_a_analysis/PAPER_DRAFT_32_TABLES_FIXED.docx", desc: "All tables expanded to full width with readable columns (Dec 17, 2025)" },
      { name: "PAPER_DRAFT_30_WITH_IMAGES_PANDOC.docx", path: "../paper_a_analysis/PAPER_DRAFT_30_WITH_IMAGES_PANDOC.docx", desc: "With images included using pandoc rebase_relative_paths (4.8MB)" },
      { name: "PAPER_DRAFT_28_WITH_FIGURES_TABLES.docx", path: "../paper_a_analysis/PAPER_DRAFT_28_WITH_FIGURES_TABLES.docx", desc: "With markdown figure references (no images in DOCX)" },
      { name: "PAPER_DRAFT_27_FINAL_COMPLETE.docx", path: "../paper_a_analysis/PAPER_DRAFT_27_FINAL_COMPLETE.docx", desc: "FINAL - All models complete including Ensemble (Dec 17, 2025)" },
      { name: "PAPER_DRAFT_26_FINAL.docx", path: "../paper_a_analysis/PAPER_DRAFT_26_FINAL.docx", desc: "FINAL - All updates complete (Dec 17, 2025)" },
      { name: "PAPER_DRAFT_25_FORMATTED.docx", path: "../paper_a_analysis/PAPER_DRAFT_25_FORMATTED.docx", desc: "Formatted with author template (Dec 17, 2025)" },
      { name: "PAPER_DRAFT_24_FINAL_COMPLETE.docx", path: "../paper_a_analysis/PAPER_DRAFT_24_FINAL_COMPLETE.docx", desc: "Final Complete (Dec 16, 2025)" },
      { name: "PAPER_DRAFT_23_COMPLETE_WITH_TESTS.docx", path: "../paper_a_analysis/PAPER_DRAFT_23_COMPLETE_WITH_TESTS.docx", desc: "With Statistical Tests (Dec 16, 2025)" },
      { name: "PAPER_DRAFT_22_COMPLETE.docx", path: "../paper_a_analysis/PAPER_DRAFT_22_COMPLETE.docx", desc: "Complete Version (Dec 16, 2025)" },
      { name: "PAPER_DRAFT_21_FINAL_UPDATES.docx", path: "../paper_a_analysis/PAPER_DRAFT_21_FINAL_UPDATES.docx", desc: "Final Updates (Dec 16, 2025)" },
      { name: "PAPER_DRAFT_20_CONSISTENCY_FIXED.docx", path: "../paper_a_analysis/PAPER_DRAFT_20_CONSISTENCY_FIXED.docx", desc: "Consistency Fixes (Dec 16, 2025)" },
      { name: "PAPER_DRAFT_19.docx", path: "../paper_a_analysis/PAPER_DRAFT_19.docx", desc: "Version 19 (Dec 16, 2025)" },
      { name: "PAPER_DRAFT_18.docx", path: "../paper_a_analysis/PAPER_DRAFT_18.docx", desc: "Version 18 (Dec 16, 2025)" },
      { name: "PAPER_DRAFT_17.docx", path: "../paper_a_analysis/PAPER_DRAFT_17.docx", desc: "Version 17 (Dec 16, 2025)" },
      { name: "PAPER_DRAFT_16.docx", path: "../paper_a_analysis/PAPER_DRAFT_16.docx", desc: "Version 16 (Dec 16, 2025)" },
      { name: "PAPER_DRAFT_15.docx", path: "../paper_a_analysis/PAPER_DRAFT_15.docx", desc: "Version 15 (Dec 16, 2025)" },
      { name: "PAPER_DRAFT_14.docx", path: "../paper_a_analysis/PAPER_DRAFT_14.docx", desc: "Version 14 (Dec 15, 2025)" },
      { name: "PAPER_DRAFT_13.docx", path: "../paper_a_analysis/PAPER_DRAFT_13.docx", desc: "Version 13 (Dec 15, 2025)" },
      { name: "PAPER_DRAFT_12.docx", path: "../paper_a_analysis/PAPER_DRAFT_12.docx", desc: "Version 12 (Dec 15, 2025)" },
      { name: "PAPER_DRAFT_11.docx", path: "../paper_a_analysis/PAPER_DRAFT_11.docx", desc: "Version 11 (Dec 15, 2025)" },
      { name: "PAPER_DRAFT_10.docx", path: "../paper_a_analysis/PAPER_DRAFT_10.docx", desc: "Version 10 (Dec 15, 2025)" },
      { name: "PAPER_DRAFT_9.docx", path: "../paper_a_analysis/PAPER_DRAFT_9.docx", desc: "Version 9 (Dec 15, 2025)" },
      { name: "PAPER_DRAFT_8.docx", path: "../paper_a_analysis/PAPER_DRAFT_8.docx", desc: "Version 8 (Dec 15, 2025)" },
      { name: "PAPER_DRAFT.docx", path: "../paper_a_analysis/PAPER_DRAFT.docx", desc: "Initial Version (Dec 15, 2025)" },
    ];
    
    function renderDocxDropdown() {
      const dropdown = document.getElementById('docxDropdown');
      dropdown.innerHTML = docxFiles.map((file, index) => `
        <a href="${file.path}" target="_blank" onclick="openFile('${file.path}', event); return false;">
          <strong>${file.name}</strong><br>
          <small style="color: var(--text-secondary);">${file.desc}</small>
        </a>
      `).join('');
    }
    
    function toggleDocxDropdown() {
      const dropdown = document.getElementById('docxDropdown');
      const arrow = document.getElementById('docxArrow');
      dropdown.classList.toggle('show');
      arrow.textContent = dropdown.classList.contains('show') ? '‚ñ≤' : '‚ñº';
    }
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('docxDropdown');
      const button = document.querySelector('.docx-main-button');
      if (dropdown && button && !button.contains(event.target) && !dropdown.contains(event.target)) {
        dropdown.classList.remove('show');
        document.getElementById('docxArrow').textContent = '‚ñº';
      }
    });
    
    // Theme toggle
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      document.getElementById('themeIcon').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }
    
    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    document.getElementById('themeIcon').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    
    // Dashboard file rendering
    function renderFiles(category, files) {
      const container = document.getElementById(category);
      container.innerHTML = files.map(file => `
        <li>
          <a href="${file.path}" onclick="openFile('${file.path}', event); return false;">${file.name}</a>
          <span class="file-type">${file.type}</span>
          <div class="file-meta">${file.desc}</div>
        </li>
      `).join('');
    }
    
    // File search
    function searchFiles(query) {
      const lists = document.querySelectorAll('.file-list');
      lists.forEach(list => {
        const items = list.querySelectorAll('li');
        items.forEach(item => {
          const text = item.textContent.toLowerCase();
          if (text.includes(query.toLowerCase())) {
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });
      });
    }
    
    // File preview modal
    function showFilePreview(filePath, fileName) {
      const modal = document.getElementById('filePreviewModal');
      const modalTitle = document.getElementById('filePreviewTitle');
      const modalContent = document.getElementById('filePreviewContent');
      const modalDownload = document.getElementById('filePreviewDownload');
      const content = document.querySelector('.file-preview-content');
      
      // Reset to normal size when opening new file
      if (content) {
        content.classList.remove('fullscreen');
        modal.classList.remove('fullscreen');
        updateResizeButton(false);
      }
      
      modalTitle.textContent = fileName;
      modalContent.innerHTML = '<p>Loading preview...</p>';
      modal.style.display = 'block';
      
      // Determine file type
      const ext = filePath.split('.').pop().toLowerCase();
      const isTextFile = ['md', 'txt', 'log', 'csv', 'r', 'rdata'].includes(ext);
      const isDocx = ext === 'docx';
      
      // Set download link
      modalDownload.href = filePath;
      modalDownload.download = fileName;
      modalDownload.style.display = 'inline-block';
      
      if (isTextFile) {
        // Fetch and display text content
        fetch(filePath)
          .then(response => {
            if (!response.ok) {
              // If file not found, try Google Drive
              if (response.status === 404) {
                modalContent.innerHTML = `
                  <div style="padding: 2rem; text-align: center;">
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                      This file is stored in Google Drive. Click the download button to access it.
                    </p>
                    <a href="${DRIVE_FOLDER_URL}" class="drive-button" target="_blank" style="margin-top: 1rem;">
                      <span>üìÅ</span>
                      <span>Open Google Drive</span>
                    </a>
                  </div>
                `;
                modalDownload.href = DRIVE_FOLDER_URL;
                modalDownload.textContent = 'Open in Google Drive';
                modalDownload.download = '';
                return;
              }
              throw new Error('File not found');
            }
            return response.text();
          })
          .then(text => {
            if (text) {
              // Format text based on file type
              if (ext === 'md') {
                // Simple markdown rendering (basic)
                const html = text
                  .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                  .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                  .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                  .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                  .replace(/\*(.*?)\*/g, '<em>$1</em>')
                  .replace(/`(.*?)`/g, '<code>$1</code>')
                  .replace(/\n/g, '<br>');
                modalContent.innerHTML = `<div style="max-height: 60vh; overflow-y: auto; padding: 1rem; background: var(--bg-primary); border-radius: 8px; font-family: monospace; font-size: 0.9rem; line-height: 1.6;">${html}</div>`;
              } else if (ext === 'csv') {
                // Show CSV as table
                const lines = text.split('\n').filter(l => l.trim());
                const rows = lines.slice(0, 100).map(line => {
                  const cells = line.split(',').map(cell => `<td>${cell.trim()}</td>`).join('');
                  return `<tr>${cells}</tr>`;
                }).join('');
                modalContent.innerHTML = `
                  <div style="max-height: 60vh; overflow: auto; padding: 1rem;">
                    <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                      Showing first 100 rows. Download for full file.
                    </p>
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                      ${rows}
                    </table>
                  </div>
                `;
              } else {
                // Plain text with syntax highlighting for code files
                const isCode = ['r', 'rdata'].includes(ext);
                const className = isCode ? 'language-r' : '';
                modalContent.innerHTML = `
                  <pre style="max-height: 60vh; overflow-y: auto; padding: 1rem; background: var(--bg-primary); border-radius: 8px; font-family: 'Courier New', monospace; font-size: 0.85rem; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word;">${escapeHtml(text)}</pre>
                `;
              }
            }
          })
          .catch(error => {
            modalContent.innerHTML = `
              <div style="padding: 2rem; text-align: center;">
                <p style="color: #d32f2f; margin-bottom: 1rem;">‚ö†Ô∏è Could not load preview</p>
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">${error.message}</p>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">
                  This file may be in Google Drive. Click download to access it.
                </p>
                <a href="${DRIVE_FOLDER_URL}" class="drive-button" target="_blank" style="margin-top: 1rem;">
                  <span>üìÅ</span>
                  <span>Open Google Drive</span>
                </a>
              </div>
            `;
            modalDownload.href = DRIVE_FOLDER_URL;
            modalDownload.textContent = 'Open in Google Drive';
            modalDownload.download = '';
          });
      } else if (isDocx) {
        // DOCX files - try to preview using Google Docs Viewer
        modalContent.innerHTML = '<p style="text-align: center; padding: 2rem;">Loading DOCX preview...</p>';
        
        // First, try to fetch from repo
        fetch(filePath)
          .then(response => {
            if (response.ok) {
              // File is in repo, convert with mammoth.js
              return response.blob();
            } else {
              // File not in repo, it's in Google Drive
              // Use Google Docs Viewer with Google Drive link
              throw new Error('File in Google Drive');
            }
          })
          .then(blob => {
            // File is in repo, convert with mammoth.js
            const reader = new FileReader();
            reader.onload = function(e) {
              const arrayBuffer = e.target.result;
              
              if (typeof mammoth !== 'undefined') {
                mammoth.convertToHtml({arrayBuffer: arrayBuffer})
                  .then(function(result) {
                    // Process HTML to constrain image sizes
                    let html = result.value;
                    // Add style to all images to constrain their size
                    html = html.replace(/<img([^>]*)>/gi, function(match, attrs) {
                      // Check if style already exists
                      if (attrs.includes('style=')) {
                        return match.replace(/style="([^"]*)"/gi, function(styleMatch, styleContent) {
                          return `style="${styleContent}; max-width: 100%; max-height: 60vh; height: auto; display: block; margin: 1rem auto;"`;
                        });
                      } else {
                        return `<img${attrs} style="max-width: 100%; max-height: 60vh; height: auto; display: block; margin: 1rem auto;">`;
                      }
                    });
                    // Also handle figures
                    html = html.replace(/<figure([^>]*)>/gi, '<figure$1 style="max-width: 100%; margin: 1rem auto; text-align: center;">');
                    
                    modalContent.innerHTML = `
                      <div style="max-height: 60vh; overflow-y: auto; padding: 2rem; background: var(--bg-secondary); border-radius: 8px;">
                        <div style="font-family: 'Times New Roman', serif; line-height: 1.6; color: var(--text-primary); max-width: 800px; margin: 0 auto;">
                          ${html}
                        </div>
                        ${result.messages.length > 0 ? '<p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 1rem; text-align: center;">Note: Some formatting may not be preserved.</p>' : ''}
                      </div>
                    `;
                  })
                  .catch(function(error) {
                    console.error('Mammoth error:', error);
                    showDocxGoogleDriveViewer(modalContent, modalDownload, fileName);
                  });
              } else {
                showDocxGoogleDriveViewer(modalContent, modalDownload, fileName);
              }
            };
            reader.readAsArrayBuffer(blob);
          })
          .catch(error => {
            // File is in Google Drive - use Google Docs Viewer
            showDocxGoogleDriveViewer(modalContent, modalDownload, fileName);
          });
      } else {
        // Other file types
        modalContent.innerHTML = `
          <div style="padding: 2rem; text-align: center;">
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
              Preview not available for this file type. Download to view.
            </p>
          </div>
        `;
      }
    }
    
    function showDocxGoogleDriveViewer(modalContent, modalDownload, fileName) {
        // For Google Drive files, we need to construct a viewer URL
        // Since files are in Google Drive, we'll embed the Google Drive viewer
        // The user needs to open the file in Google Drive first to get the file ID
        // For now, show instructions and Google Drive link
        
        modalContent.innerHTML = `
          <div style="padding: 2rem;">
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; text-align: center;">
              This DOCX file is in Google Drive. To preview it:
            </p>
            <div style="background: var(--bg-primary); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
              <p style="color: var(--text-primary); margin-bottom: 1rem; font-weight: 600;">Option 1: Preview in Google Drive</p>
              <ol style="color: var(--text-secondary); margin-left: 1.5rem; line-height: 1.8;">
                <li>Click "Open in Google Drive" below</li>
                <li>Find and open the file: <strong>${fileName}</strong></li>
                <li>Google Drive will show a preview automatically</li>
              </ol>
            </div>
            <div style="background: var(--bg-primary); padding: 1.5rem; border-radius: 8px;">
              <p style="color: var(--text-primary); margin-bottom: 1rem; font-weight: 600;">Option 2: Download and Open</p>
              <p style="color: var(--text-secondary);">
                Use the download button below to download the file, then open it with Microsoft Word, Google Docs, or another DOCX viewer.
              </p>
            </div>
            <div style="text-align: center; margin-top: 1.5rem;">
              <a href="${DRIVE_FOLDER_URL}" class="drive-button" target="_blank">
                <span>üìÅ</span>
                <span>Open in Google Drive</span>
              </a>
            </div>
          </div>
        `;
        modalDownload.href = DRIVE_FOLDER_URL;
        modalDownload.textContent = 'Open in Google Drive';
        modalDownload.download = '';
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function closeFilePreview() {
      const modal = document.getElementById('filePreviewModal');
      const content = document.querySelector('.file-preview-content');
      modal.style.display = 'none';
      // Reset to normal size when closing
      if (content) {
        content.classList.remove('fullscreen');
        modal.classList.remove('fullscreen');
        updateResizeButton(false);
      }
    }
    
    function togglePreviewSize() {
      const modal = document.getElementById('filePreviewModal');
      const content = document.querySelector('.file-preview-content');
      const isFullscreen = content.classList.contains('fullscreen');
      
      if (isFullscreen) {
        // Switch to normal size
        content.classList.remove('fullscreen');
        modal.classList.remove('fullscreen');
        updateResizeButton(false);
      } else {
        // Switch to fullscreen
        content.classList.add('fullscreen');
        modal.classList.add('fullscreen');
        updateResizeButton(true);
      }
    }
    
    function updateResizeButton(isFullscreen) {
      const icon = document.getElementById('resizeIcon');
      const text = document.getElementById('resizeText');
      if (icon && text) {
        if (isFullscreen) {
          icon.textContent = '‚õ∂';
          text.textContent = 'Normal';
        } else {
          icon.textContent = '‚õ∂';
          text.textContent = 'Fullscreen';
        }
      }
    }
    
    // About Modal Functions
    function openAboutModal() {
      document.getElementById('aboutModal').style.display = 'block';
    }
    
    function closeAboutModal() {
      document.getElementById('aboutModal').style.display = 'none';
    }
    
    // Close modals when clicking outside
    window.addEventListener('click', function(event) {
      const aboutModal = document.getElementById('aboutModal');
      const filePreviewModal = document.getElementById('filePreviewModal');
      if (event.target === aboutModal) {
        closeAboutModal();
      }
      if (event.target === filePreviewModal) {
        closeFilePreview();
      }
    });
    
    // File opening - show preview instead of direct open
    function openFile(path, event) {
      if (event) {
        event.preventDefault();
        event.stopPropagation();
      }
      
      const fileName = path.split('/').pop();
      showFilePreview(path, fileName);
    }
    
    // Script Status - Multiple Scripts
    async function updateScriptStatus() {
      const statusDiv = document.getElementById('script-status-content');
      
      // Define all scripts to monitor with their log files and descriptions
      const scripts = [
        {
          name: 'All Models (Clean Variables)',
          logFile: 'all_models_CLEAN.log',
          scriptFile: '09g_all_models_CLEAN_variables.R',
          description: 'Runs RF, XGBoost, GAM, NN, LightGBM, CatBoost, Ensemble with 26 clean variables'
        },
        {
          name: 'Comprehensive Analysis (All Models)',
          logFile: 'comprehensive_analysis_ALL.log',
          scriptFile: '09_comprehensive_model_comparison_ALL.R',
          description: 'Full model comparison with all 7 models (44 variables)'
        },
        {
          name: 'Comprehensive Analysis',
          logFile: 'comprehensive_analysis.log',
          scriptFile: '09_comprehensive_model_comparison.R',
          description: 'Model comparison analysis'
        },
        {
          name: 'EDS Comprehensive Analysis',
          logFile: 'eds_comprehensive_analysis.log',
          scriptFile: '11_eds_comprehensive_analysis.R',
          description: 'Country-level EDS analysis with regression, ANOVA, regional comparisons'
        },
        {
          name: 'EDS Analysis',
          logFile: 'eds_analysis.log',
          scriptFile: '11_eds_focused_analysis.R',
          description: 'EDS-focused country-level analysis'
        },
        {
          name: 'Future Work Analyses',
          logFile: 'future_work_analyses.log',
          scriptFile: '99_run_future_work_analyses.R',
          description: 'Individual vehicle EDS, temporal, and charging infrastructure analyses'
        }
      ];
      
      let allStatusHTML = '<div style="display: grid; gap: 1.5rem;">';
      
      // Fetch status for each script
      const statusPromises = scripts.map(async (script) => {
        try {
          const response = await fetch(`logs/${script.logFile}`);
          if (!response.ok) {
            return {
              script: script,
              status: 'not_found',
              content: null
            };
          }
          const logText = await response.text();
          const lines = logText.split('\n').filter(l => l.trim());
          const lastLines = lines.slice(-5);
          
          // Determine status
          const hasError = logText.toLowerCase().includes('error') || 
                          logText.toLowerCase().includes('halted') ||
                          logText.toLowerCase().includes('execution halted');
          const isComplete = logText.toLowerCase().includes('complete') || 
                            logText.toLowerCase().includes('finished') ||
                            logText.toLowerCase().includes('saved to:') ||
                            (logText.toLowerCase().includes('ensemble') && !hasError);
          
          let statusType = 'unknown';
          let statusIcon = '‚è≥';
          let statusColor = 'orange';
          
          if (isComplete && !hasError) {
            statusType = 'complete';
            statusIcon = '‚úÖ';
            statusColor = 'green';
          } else if (hasError) {
            statusType = 'error';
            statusIcon = '‚ùå';
            statusColor = 'red';
          } else if (lines.length > 10) {
            statusType = 'running';
            statusIcon = '‚è≥';
            statusColor = 'blue';
          }
          
          return {
            script: script,
            status: statusType,
            statusIcon: statusIcon,
            statusColor: statusColor,
            lastLines: lastLines,
            logText: logText,
            lineCount: lines.length
          };
        } catch (err) {
          return {
            script: script,
            status: 'error',
            statusIcon: '‚ùå',
            statusColor: 'red',
            error: err.message,
            content: null
          };
        }
      });
      
      const statuses = await Promise.all(statusPromises);
      
      // Render each script's status
      statuses.forEach((statusInfo) => {
        const { script, status, statusIcon, statusColor, lastLines, logText, lineCount, error } = statusInfo;
        
        allStatusHTML += `
          <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--${statusColor === 'green' ? 'accent' : statusColor === 'red' ? 'error' : 'warning'}); box-shadow: 0 2px 8px var(--shadow);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
              <h4 style="margin: 0; color: var(--text-primary);">${statusIcon} ${script.name}</h4>
              <span style="font-size: 0.85rem; color: var(--text-secondary);">${lineCount || 0} lines</span>
            </div>
            <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.75rem;">${script.description}</p>
            <div style="margin-bottom: 0.75rem;">
              <strong style="color: ${statusColor};">Status:</strong> 
              <span style="color: ${statusColor};">${status === 'complete' ? 'Completed' : status === 'error' ? 'Error/Crashed' : status === 'running' ? 'Running/In Progress' : 'Unknown'}</span>
            </div>
        `;
        
        if (error) {
          allStatusHTML += `<p style="color: red; font-size: 0.85rem;">Error loading log: ${error}</p>`;
        } else if (lastLines && lastLines.length > 0) {
          allStatusHTML += `
            <details style="margin-top: 0.5rem;">
              <summary style="cursor: pointer; color: var(--accent); font-size: 0.9rem;">Last 5 lines of log</summary>
              <pre style="background: var(--bg-primary); padding: 0.75rem; border-radius: 6px; overflow-x: auto; font-size: 0.75rem; margin-top: 0.5rem; max-height: 150px; overflow-y: auto;">${lastLines.join('\n')}</pre>
            </details>
          `;
        }
        
        // Extract specific information based on script type
        if (logText) {
          if (script.name.includes('All Models')) {
            const modelsCompleted = [];
            if (logText.includes('Random Forest already completed') || logText.includes('Random Forest complete')) modelsCompleted.push('RF');
            if (logText.includes('XGBoost already completed') || logText.includes('XGBoost complete')) modelsCompleted.push('XGBoost');
            if (logText.includes('GAM already completed') || logText.includes('GAM complete')) modelsCompleted.push('GAM');
            if (logText.includes('Neural Network already completed') || logText.includes('Neural Network complete')) modelsCompleted.push('NN');
            if (logText.includes('LightGBM complete')) modelsCompleted.push('LightGBM');
            if (logText.includes('CatBoost complete')) modelsCompleted.push('CatBoost');
            if (logText.includes('Ensemble complete') || logText.includes('All models complete')) modelsCompleted.push('Ensemble');
            if (modelsCompleted.length > 0) {
              allStatusHTML += `<div style="margin-top: 0.5rem; font-size: 0.85rem;"><strong>Models:</strong> ${modelsCompleted.join(', ')}</div>`;
            }
          } else if (script.name.includes('EDS')) {
            const r2Match = logText.match(/R¬≤:\s*([\d.]+)/);
            if (r2Match) {
              allStatusHTML += `<div style="margin-top: 0.5rem; font-size: 0.85rem;"><strong>Best R¬≤:</strong> ${r2Match[1]}</div>`;
            }
            if (logText.includes('Temperature data merged for')) {
              const countriesMatch = logText.match(/Temperature data merged for (\d+) countries/);
              if (countriesMatch) {
                allStatusHTML += `<div style="margin-top: 0.5rem; font-size: 0.85rem;"><strong>Countries analyzed:</strong> ${countriesMatch[1]}</div>`;
              }
            }
          }
        }
        
        allStatusHTML += `</div>`;
      });
      
      allStatusHTML += '</div>';
      statusDiv.innerHTML = allStatusHTML;
      document.getElementById('script-status-explanation').innerHTML = explainScriptStatus();
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Timeline will be rendered when JSON loads
      // If JSON fails, show message
      setTimeout(() => {
        if (timelineData.length === 0 && allTimelineData.length === 0) {
          document.getElementById('timeline-content').innerHTML = 
            '<p style="padding: 2rem; text-align: center; color: var(--text-secondary);">Timeline data loading... If this persists, check that TIMELINE_DATA.json exists.</p>';
        }
      }, 1000);
      
      renderFiles('paper-files', fileData.paper);
      renderFiles('script-files', fileData.scripts);
      renderFiles('result-files', fileData.results);
      renderFiles('doc-files', fileData.docs);
      if (fileData.logs) renderFiles('log-files', fileData.logs);
      if (fileData.scripts_all) renderFiles('scripts-all-files', fileData.scripts_all);
      if (fileData.utilities) renderFiles('utilities-files', fileData.utilities);
      renderDocxDropdown();
      updateScriptStatus();
      
      // Update script status every 30 seconds
      setInterval(updateScriptStatus, 30000);
    });
    
    // Explanation of script status
    function explainScriptStatus() {
      const explanation = `
        <div style="background: var(--bg-primary); padding: 1.5rem; border-radius: 12px; margin-top: 1rem;">
          <h4>üìù Script Status Monitoring</h4>
          <p style="margin-top: 0.5rem; color: var(--text-secondary);">
            This section monitors <strong>6 different analysis scripts</strong> and their log files:
          </p>
          <ul style="margin-left: 1.5rem; margin-top: 0.5rem; color: var(--text-secondary);">
            <li><strong>All Models (Clean Variables):</strong> Runs RF, XGBoost, GAM, NN, LightGBM, CatBoost, Ensemble with 26 clean variables</li>
            <li><strong>Comprehensive Analysis (All Models):</strong> Full model comparison with all 7 models using 44 variables</li>
            <li><strong>Comprehensive Analysis:</strong> Standard model comparison analysis</li>
            <li><strong>EDS Comprehensive Analysis:</strong> Country-level EDS analysis with regression, ANOVA, regional comparisons</li>
            <li><strong>EDS Analysis:</strong> EDS-focused country-level analysis</li>
            <li><strong>Future Work Analyses:</strong> Individual vehicle EDS, temporal, and charging infrastructure analyses</li>
          </ul>
          <p style="margin-top: 1rem; color: var(--text-secondary);">
            <strong>Status Indicators:</strong>
          </p>
          <ul style="margin-left: 1.5rem; margin-top: 0.5rem; color: var(--text-secondary);">
            <li>‚úÖ <strong>Green:</strong> Script completed successfully</li>
            <li>‚ùå <strong>Red:</strong> Script crashed or encountered an error</li>
            <li>‚è≥ <strong>Blue/Orange:</strong> Script is running or status is unknown</li>
          </ul>
          <p style="margin-top: 1rem; color: var(--text-secondary);">
            <strong>Auto-refresh:</strong> Status updates every 30 seconds. Click "Last 5 lines of log" to see recent output from each script.
          </p>
        </div>
      `;
      return explanation;
    }
    
    // Google Drive link configuration (defined at top level for all functions)
    // This is already defined above, keeping for reference
  </script>
  
  <!-- About Modal -->
  <div id="aboutModal" class="about-modal" onclick="if(event.target === this) closeAboutModal()">
    <div class="about-modal-content" onclick="event.stopPropagation()">
      <div class="about-modal-header">
        <h3>About This Website</h3>
        <span class="about-modal-close" onclick="closeAboutModal()">&times;</span>
      </div>
      <div class="about-modal-body">
        <p><strong>About this research portal:</strong></p>
        <p>This interactive research portal (also referred to as a platform or web application) tracks the complete development progression of Paper A, a research study analyzing real-world energy consumption and electric driving share (EDS) of plug-in hybrid vehicles (PHEVs) across Europe. The portal provides a comprehensive timeline of all development milestones, methodology changes, and analysis iterations from the initial baseline model through to the final ensemble model with 26 clean variables.</p>
        
        <p>Users can explore the evolution of the research through an interactive timeline, monitor script execution status in real-time, access all paper drafts and documentation files, and view detailed dashboards of analysis scripts, results, and figures. The portal serves as both a development log and a navigation hub, connecting researchers to all project resources including R analysis scripts, generated figures and tables, methodology documentation, and paper drafts stored both locally and in Google Drive.</p>
        
        <p>The portal features a <strong>figures portfolio (gallery)</strong> showcasing 34+ visualizations including energy distributions, EDS analysis, model comparisons, and regional comparisons, as well as a <strong>tables portfolio</strong> with 16 comprehensive data tables covering dataset overview, model performance, regional summaries, and statistical analyses. These portfolios provide easy access to all research outputs and visualizations.</p>
        
        <p>The platform features filtering capabilities to view milestones, corrections, or specific analysis types, and provides real-time monitoring of analysis script execution with status indicators and log previews. It also includes interactive file previews for DOCX documents with fullscreen viewing options, making it easy to review paper drafts and documentation directly in the browser.</p>
        
        <p style="margin-top: 1.5rem; padding-top: 1rem; border-top: 2px solid var(--bg-primary);"><strong>Technical details:</strong></p>
        <p>This portal is built as a static website using <strong>HTML</strong> (structure), <strong>CSS</strong> (styling and responsive design), and <strong>JavaScript</strong> (interactivity, timeline rendering, file previews, and real-time updates). It uses modern web technologies including the Mammoth.js library for DOCX file previews and is deployed via GitHub Pages. The portal is designed to be fast, responsive, and accessible without requiring any backend server or database.</p>
        
        <p style="margin-top: 1.5rem; padding-top: 1rem; border-top: 2px solid var(--bg-primary);"><strong>Short description:</strong></p>
        <p>This research portal tracks the complete development progression of Paper A, providing an interactive timeline of milestones, real-time script monitoring, and access to all research resources including paper drafts, analysis scripts, figures portfolio (gallery), tables portfolio, and documentation for the PHEV energy consumption and EDS research study. Built with HTML, CSS, and JavaScript as a static web application.</p>
      </div>
    </div>
  </div>
  
  <!-- File Preview Modal -->
  <div id="filePreviewModal" class="file-preview-modal" onclick="if(event.target === this) closeFilePreview()">
    <div class="file-preview-content" onclick="event.stopPropagation()">
      <div class="file-preview-header">
        <h3 id="filePreviewTitle">File Preview</h3>
        <div class="file-preview-header-controls">
          <button class="file-preview-resize" id="filePreviewResize" onclick="togglePreviewSize()" title="Toggle fullscreen">
            <span id="resizeIcon">‚õ∂</span>
            <span id="resizeText">Fullscreen</span>
          </button>
          <span class="file-preview-close" onclick="closeFilePreview()">&times;</span>
        </div>
      </div>
      <div class="file-preview-body" id="filePreviewContent">
        <p>Loading...</p>
      </div>
      <div class="file-preview-footer">
        <a id="filePreviewDownload" href="#" class="file-preview-download" download>
          <span>‚¨áÔ∏è</span>
          <span>Download File</span>
        </a>
      </div>
    </div>
  </div>
  
  <!-- Google Drive Section -->
  <div class="container">
    <div class="dashboard-card drive-section" style="border-left: 4px solid #4285f4;">
      <h3>üìö Literature Reviews & Database Files</h3>
      <p style="color: var(--text-secondary); margin-bottom: 1rem;">
        <strong>Literature reviews (.txt files from papers)</strong> and <strong>database files</strong> are stored in Google Drive 
        (too large for GitHub). Access all research materials:
      </p>
      <a href="#" id="drive-link-progression" class="drive-button" target="_blank" rel="noopener noreferrer">
        <span>üìÅ</span>
        <span>Open Google Drive Folder</span>
        <span>‚Üí</span>
      </a>
      <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-primary); border-radius: 8px;">
        <h4 style="font-size: 0.95rem; color: var(--accent); margin-bottom: 0.75rem;">What's in Google Drive:</h4>
        <ul style="margin: 0; padding-left: 1.5rem; color: var(--text-secondary); font-size: 0.9rem;">
          <li><strong>Literature Reviews:</strong> All .txt files from paper reviews (54+ files)</li>
          <li><strong>Database Files:</strong> Large datasets and data archives</li>
          <li><strong>Paper Drafts:</strong> DOCX files and working documents</li>
          <li><strong>Supplementary Materials:</strong> Additional analysis files</li>
        </ul>
      </div>
    </div>
  </div>
  
  <script>
    // Set Google Drive link
    if (DRIVE_FOLDER_URL !== 'YOUR_GOOGLE_DRIVE_FOLDER_URL_HERE') {
      document.getElementById('drive-link-progression').href = DRIVE_FOLDER_URL;
    } else {
      // Hide section if URL not set
      document.querySelector('.drive-section').style.display = 'none';
    }
  </script>
</body>
</html>






